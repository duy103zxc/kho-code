<!DOCTYPE HTML>
<html lang="vi" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>「SS」Hướng dẫn Spring Security + JWT (Json Web Token) + Hibernate - Kho code của duykhanh471</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../index.html"><strong aria-hidden="true">1.</strong> Trang chủ dự án</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.</strong> HTML/CSS/JS</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../html-css/index.html"><strong aria-hidden="true">2.1.</strong> HTML/CSS</a></li><li class="chapter-item expanded "><a href="../js/index.html"><strong aria-hidden="true">2.2.</strong> JS</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../js/co-ban.html"><strong aria-hidden="true">2.2.1.</strong> Cơ bản</a></li><li class="chapter-item expanded "><a href="../js/array.html"><strong aria-hidden="true">2.2.2.</strong> Array</a></li><li class="chapter-item expanded "><a href="../js/ngay-gio.html"><strong aria-hidden="true">2.2.3.</strong> Ngày giờ</a></li><li class="chapter-item expanded "><a href="../js/string.html"><strong aria-hidden="true">2.2.4.</strong> String</a></li><li class="chapter-item expanded "><a href="../js/object.html"><strong aria-hidden="true">2.2.5.</strong> Object</a></li></ol></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.</strong> Java</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../java/1.html"><strong aria-hidden="true">3.1.</strong> Giới thiệu Java, JVM</a></li><li class="chapter-item expanded "><a href="../java/2.html"><strong aria-hidden="true">3.2.</strong> Biến, phạm vi, kiểu dữ liệu, toán tử trong Java</a></li><li class="chapter-item expanded "><a href="../java/3.html"><strong aria-hidden="true">3.3.</strong> Hàm và câu lệnh điều kiện</a></li><li class="chapter-item expanded "><a href="../java/4.html"><strong aria-hidden="true">3.4.</strong> Nhập xuất dữ liệu trong Java</a></li><li class="chapter-item expanded "><a href="../java/5.html"><strong aria-hidden="true">3.5.</strong> Vì sao nên sử dụng StringBuffer</a></li><li class="chapter-item expanded "><a href="../java/6.html"><strong aria-hidden="true">3.6.</strong> Hướng dẫn Java Reflection</a></li><li class="chapter-item expanded "><a href="../java/7.html"><strong aria-hidden="true">3.7.</strong> Hướng dẫn tự tạo một Annotations</a></li><li class="chapter-item expanded "><a href="../java/8.html"><strong aria-hidden="true">3.8.</strong> Functional Interfaces & Lambda Expressions cực dễ hiểu</a></li><li class="chapter-item expanded "><a href="../java/9.html"><strong aria-hidden="true">3.9.</strong> Hướng dẫn Stream API</a></li><li class="chapter-item expanded "><a href="../java/10.html"><strong aria-hidden="true">3.10.</strong> Khái niệm ThreadPool và Executor trong Java</a></li><li class="chapter-item expanded "><a href="../java/11.html"><strong aria-hidden="true">3.11.</strong> ThreadPoolExecutor và nguyên tắc quản lý pool size</a></li><li class="chapter-item expanded "><a href="../java/12.html"><strong aria-hidden="true">3.12.</strong> Giới thiệu Reactive Programming với Reactor</a></li><li class="chapter-item expanded "><a href="../java/13.html"><strong aria-hidden="true">3.13.</strong> Giới thiệu Reactor Core</a></li><li class="chapter-item expanded "><a href="../java/14.html"><strong aria-hidden="true">3.14.</strong> Abstract Interface</a></li><li class="chapter-item expanded "><a href="../java/15.html"><strong aria-hidden="true">3.15.</strong> Thread</a></li><li class="chapter-item expanded "><a href="../java/16.html"><strong aria-hidden="true">3.16.</strong> Optional</a></li><li class="chapter-item expanded "><a href="../java/snippets/index.html"><strong aria-hidden="true">3.17.</strong> Kho snippets</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../java/snippets/algorithms.html"><strong aria-hidden="true">3.17.1.</strong> Algorithms</a></li><li class="chapter-item expanded "><a href="../java/snippets/array.html"><strong aria-hidden="true">3.17.2.</strong> Array</a></li><li class="chapter-item expanded "><a href="../java/snippets/cls.html"><strong aria-hidden="true">3.17.3.</strong> CLS</a></li><li class="chapter-item expanded "><a href="../java/snippets/date.html"><strong aria-hidden="true">3.17.4.</strong> Date</a></li><li class="chapter-item expanded "><a href="../java/snippets/encoding.html"><strong aria-hidden="true">3.17.5.</strong> Encoding & Decoding</a></li><li class="chapter-item expanded "><a href="../java/snippets/file.html"><strong aria-hidden="true">3.17.6.</strong> File</a></li><li class="chapter-item expanded "><a href="../java/snippets/io.html"><strong aria-hidden="true">3.17.7.</strong> IO</a></li><li class="chapter-item expanded "><a href="../java/snippets/math.html"><strong aria-hidden="true">3.17.8.</strong> Math</a></li><li class="chapter-item expanded "><a href="../java/snippets/media.html"><strong aria-hidden="true">3.17.9.</strong> Media</a></li><li class="chapter-item expanded "><a href="../java/snippets/network.html"><strong aria-hidden="true">3.17.10.</strong> Network</a></li><li class="chapter-item expanded "><a href="../java/snippets/string.html"><strong aria-hidden="true">3.17.11.</strong> String</a></li><li class="chapter-item expanded "><a href="../java/snippets/thread.html"><strong aria-hidden="true">3.17.12.</strong> Thread</a></li></ol></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.</strong> Spring Boot</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../spring-boot/index.html"><strong aria-hidden="true">4.1.</strong> Trang chủ khóa học</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.2.</strong> Core</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../spring-boot/core1.html"><strong aria-hidden="true">4.2.1.</strong> Khái niệm tight-coupling (liên kết ràng buộc) và cách loosely coupled</a></li><li class="chapter-item expanded "><a href="../spring-boot/core2.html"><strong aria-hidden="true">4.2.2.</strong> Giải thích Dependency Injection (DI) và IoC</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.3.</strong> Spring Boot</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../spring-boot/sb1.html"><strong aria-hidden="true">4.3.1.</strong> Hướng dẫn @Component và @Autowired</a></li><li class="chapter-item expanded "><a href="../spring-boot/sb2.html"><strong aria-hidden="true">4.3.2.</strong> @Autowired - @Primary - @Qualifier</a></li><li class="chapter-item expanded "><a href="../spring-boot/sb3.html"><strong aria-hidden="true">4.3.3.</strong> Spring Bean Life Cycle + @PostConstruct và @PreDestroy</a></li><li class="chapter-item expanded "><a href="../spring-boot/sb4.html"><strong aria-hidden="true">4.3.4.</strong> @Component vs @Service vs @Repository</a></li><li class="chapter-item expanded "><a href="../spring-boot/sb5.html"><strong aria-hidden="true">4.3.5.</strong> Component Scan là gì?</a></li><li class="chapter-item expanded "><a href="../spring-boot/sb6.html"><strong aria-hidden="true">4.3.6.</strong> @Configuration và @Bean</a></li><li class="chapter-item expanded "><a href="../spring-boot/sb7.html"><strong aria-hidden="true">4.3.7.</strong> Spring Boot Application Config và @Value</a></li><li class="chapter-item expanded "><a href="../spring-boot/sb8.html"><strong aria-hidden="true">4.3.8.</strong> Tạo Web Helloworld với @Controller + Thymeleaf</a></li><li class="chapter-item expanded "><a href="../spring-boot/sb9.html"><strong aria-hidden="true">4.3.9.</strong> Giải thích cách Thymeleaf vận hành + Expression + Demo Full</a></li><li class="chapter-item expanded "><a href="../spring-boot/sb10.html"><strong aria-hidden="true">4.3.10.</strong> @RequestMapping + @PostMapping + @ModelAttribute + @RequestParam + Web To-Do với Thymeleaf</a></li><li class="chapter-item expanded "><a href="../spring-boot/sb11.html"><strong aria-hidden="true">4.3.11.</strong> Hướng dẫn Spring Boot JPA + MySQL</a></li><li class="chapter-item expanded "><a href="../spring-boot/sb12.html"><strong aria-hidden="true">4.3.12.</strong> Spring JPA Method + @Query</a></li><li class="chapter-item expanded "><a href="../spring-boot/sb13.html"><strong aria-hidden="true">4.3.13.</strong> Chi tiết Spring Boot + Thymeleaf + MySQL + i18n + Web Demo</a></li><li class="chapter-item expanded "><a href="../spring-boot/sb14.html"><strong aria-hidden="true">4.3.14.</strong> Restful API + @RestController + @PathVariable + @RequestBody</a></li><li class="chapter-item expanded "><a href="../spring-boot/sb15.html"><strong aria-hidden="true">4.3.15.</strong> Exception Handling @ExceptionHandler + @RestControllerAdvice / @ControllerAdvice + @ResponseStatus</a></li><li class="chapter-item expanded "><a href="../spring-boot/sb16.html"><strong aria-hidden="true">4.3.16.</strong> Hướng dẫn sử dụng @ConfigurationPropertie</a></li><li class="chapter-item expanded "><a href="../spring-boot/sb17.html"><strong aria-hidden="true">4.3.17.</strong> Chạy nhiều môi trường với Spring Profile</a></li><li class="chapter-item expanded "><a href="../spring-boot/sb18.html"><strong aria-hidden="true">4.3.18.</strong> Hướng dẫn chi tiết Test Spring Boot</a></li><li class="chapter-item expanded "><a href="../spring-boot/sb19.html"><strong aria-hidden="true">4.3.19.</strong> Hướng dẫn chi tiết Test Spring Boot (Phần 2)</a></li><li class="chapter-item expanded "><a href="../spring-boot/sb20.html"><strong aria-hidden="true">4.3.20.</strong> Hướng dẫn toàn tập Mockito</a></li><li class="chapter-item expanded "><a href="../spring-boot/sb21.html"><strong aria-hidden="true">4.3.21.</strong> Hướng dẫn tạo Bean có điều kiện với @Conditional</a></li><li class="chapter-item expanded "><a href="../spring-boot/sb22.html"><strong aria-hidden="true">4.3.22.</strong> Hướng dẫn tự tạo custom @Conditional</a></li><li class="chapter-item expanded "><a href="../spring-boot/sb23.html"><strong aria-hidden="true">4.3.23.</strong> Xử lý sự kiện với @EventListener + @Async</a></li><li class="chapter-item expanded "><a href="../spring-boot/sb24.html"><strong aria-hidden="true">4.3.24.</strong> RESTful API Document Tạo với Spring Boot + Swagger</a></li><li class="chapter-item expanded "><a href="../spring-boot/sb25.html"><strong aria-hidden="true">4.3.25.</strong> RESTful API Document với Spring Boot + OpenApi 3.0</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.4.</strong> Jpa</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../spring-boot/jpa1.html"><strong aria-hidden="true">4.4.1.</strong> 「Jpa」Hibernate là gì?</a></li><li class="chapter-item expanded "><a href="../spring-boot/jpa2.html"><strong aria-hidden="true">4.4.2.</strong> 「Jpa」Hướng dẫn sử dụng Specification (Phần 1)</a></li><li class="chapter-item expanded "><a href="../spring-boot/jpa3.html"><strong aria-hidden="true">4.4.3.</strong> 「Jpa」Hướng dẫn sử dụng @OneToOne</a></li><li class="chapter-item expanded "><a href="../spring-boot/jpa4.html"><strong aria-hidden="true">4.4.4.</strong> 「Jpa」@OneToMany và @ManyToOne</a></li><li class="chapter-item expanded "><a href="../spring-boot/jpa5.html"><strong aria-hidden="true">4.4.5.</strong> 「Jpa」Hướng dẫn @ManyToMany</a></li><li class="chapter-item expanded "><a href="../spring-boot/jpa6.html"><strong aria-hidden="true">4.4.6.</strong> 「Jpa」Hướng dẫn Query phân trang bằng Pageable (Phần 1)</a></li><li class="chapter-item expanded "><a href="../spring-boot/jpa7.html"><strong aria-hidden="true">4.4.7.</strong> 「Jpa」Hướng dẫn sử dụng Criteria API trong Hibernate</a></li><li class="chapter-item expanded "><a href="../spring-boot/jpa8.html"><strong aria-hidden="true">4.4.8.</strong> 「Jpa」Hướng dẫn sử dụng Criteria API trong Hibernate (Phần 2)</a></li><li class="chapter-item expanded "><a href="../spring-boot/jpa9.html"><strong aria-hidden="true">4.4.9.</strong> 「Jpa」Hướng dẫn tự tạo Validator để kiểm tra Model & Entity</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.5.</strong> Spring Security</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../spring-boot/ss1.html"><strong aria-hidden="true">4.5.1.</strong> 「SS」Hướng dẫn Spring Security cơ bản, dễ hiểu</a></li><li class="chapter-item expanded "><a href="../spring-boot/ss2.html"><strong aria-hidden="true">4.5.2.</strong> 「SS」Hướng dẫn Spring Security + Jpa Hibernate</a></li><li class="chapter-item expanded "><a href="../spring-boot/ss3.html" class="active"><strong aria-hidden="true">4.5.3.</strong> 「SS」Hướng dẫn Spring Security + JWT (Json Web Token) + Hibernate</a></li></ol></li><li class="chapter-item expanded "><a href="../spring-boot/redis.html"><strong aria-hidden="true">4.6.</strong> Redis</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.</strong> Rust</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../rust/thuat-toan.html"><strong aria-hidden="true">5.1.</strong> Thuật toán</a></li><li class="chapter-item expanded "><a href="../rust/command-line.html"><strong aria-hidden="true">5.2.</strong> CLI</a></li><li class="chapter-item expanded "><a href="../rust/he-thong.html"><strong aria-hidden="true">5.3.</strong> System</a></li><li class="chapter-item expanded "><a href="../rust/internet.html"><strong aria-hidden="true">5.4.</strong> Internet</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.5.</strong> Tệp</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../rust/tep/epub.html"><strong aria-hidden="true">5.5.1.</strong> EPUB</a></li><li class="chapter-item expanded "><a href="../rust/tep/git.html"><strong aria-hidden="true">5.5.2.</strong> Git</a></li><li class="chapter-item expanded "><a href="../rust/tep/html.html"><strong aria-hidden="true">5.5.3.</strong> HTML</a></li><li class="chapter-item expanded "><a href="../rust/tep/rss.html"><strong aria-hidden="true">5.5.4.</strong> RSS</a></li></ol></li><li class="chapter-item expanded "><a href="../rust/essentials/intro.html"><strong aria-hidden="true">5.6.</strong> Essentials</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../rust/essentials/core-concepts/intro.html"><strong aria-hidden="true">5.6.1.</strong> Core Concepts</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../rust/essentials/core-concepts/function.html"><strong aria-hidden="true">5.6.1.1.</strong> Functions</a></li><li class="chapter-item expanded "><a href="../rust/essentials/core-concepts/flow-control.html"><strong aria-hidden="true">5.6.1.2.</strong> Flow Control</a></li><li class="chapter-item expanded "><a href="../rust/essentials/core-concepts/pattern-matching.html"><strong aria-hidden="true">5.6.1.3.</strong> Pattern Matching</a></li><li class="chapter-item expanded "><a href="../rust/essentials/core-concepts/closure.html"><strong aria-hidden="true">5.6.1.4.</strong> Closures</a></li><li class="chapter-item expanded "><a href="../rust/essentials/core-concepts/ownership.html"><strong aria-hidden="true">5.6.1.5.</strong> Ownership</a></li><li class="chapter-item expanded "><a href="../rust/essentials/core-concepts/borrow.html"><strong aria-hidden="true">5.6.1.6.</strong> Borrow</a></li><li class="chapter-item expanded "><a href="../rust/essentials/core-concepts/macro.html"><strong aria-hidden="true">5.6.1.7.</strong> Macros</a></li><li class="chapter-item expanded "><a href="../rust/essentials/core-concepts/concurency.html"><strong aria-hidden="true">5.6.1.8.</strong> Concurency</a></li><li class="chapter-item expanded "><a href="../rust/essentials/core-concepts/error-handling.html"><strong aria-hidden="true">5.6.1.9.</strong> Error Handling</a></li><li class="chapter-item expanded "><a href="../rust/essentials/core-concepts/lifetime.html"><strong aria-hidden="true">5.6.1.10.</strong> Lifetime</a></li><li class="chapter-item expanded "><a href="../rust/essentials/core-concepts/module.html"><strong aria-hidden="true">5.6.1.11.</strong> Modules</a></li><li class="chapter-item expanded "><a href="../rust/essentials/core-concepts/crate.html"><strong aria-hidden="true">5.6.1.12.</strong> Crates</a></li></ol></li><li class="chapter-item expanded "><a href="../rust/essentials/types/intro.html"><strong aria-hidden="true">5.6.2.</strong> Types</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../rust/essentials/types/scalar.html"><strong aria-hidden="true">5.6.2.1.</strong> Scalar Types</a></li><li class="chapter-item expanded "><a href="../rust/essentials/types/compound.html"><strong aria-hidden="true">5.6.2.2.</strong> Compound Types</a></li><li class="chapter-item expanded "><a href="../rust/essentials/types/trait.html"><strong aria-hidden="true">5.6.2.3.</strong> Traits</a></li><li class="chapter-item expanded "><a href="../rust/essentials/types/struct.html"><strong aria-hidden="true">5.6.2.4.</strong> Structs</a></li><li class="chapter-item expanded "><a href="../rust/essentials/types/enum.html"><strong aria-hidden="true">5.6.2.5.</strong> Enums</a></li><li class="chapter-item expanded "><a href="../rust/essentials/types/struct-vs-enum.html"><strong aria-hidden="true">5.6.2.6.</strong> Structs vs Enums</a></li><li class="chapter-item expanded "><a href="../rust/essentials/types/generic.html"><strong aria-hidden="true">5.6.2.7.</strong> Generics</a></li><li class="chapter-item expanded "><a href="../rust/essentials/types/type-alias.html"><strong aria-hidden="true">5.6.2.8.</strong> Type Alias</a></li><li class="chapter-item expanded "><a href="../rust/essentials/types/pointer.html"><strong aria-hidden="true">5.6.2.9.</strong> Pointers</a></li><li class="chapter-item expanded "><a href="../rust/essentials/types/vector.html"><strong aria-hidden="true">5.6.2.10.</strong> Vectors</a></li></ol></li><li class="chapter-item expanded "><a href="../rust/essentials/operators/intro.html"><strong aria-hidden="true">5.6.3.</strong> Operators</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../rust/essentials/operators/arithmetic-operations.html"><strong aria-hidden="true">5.6.3.1.</strong> Arithmetic Operations</a></li><li class="chapter-item expanded "><a href="../rust/essentials/operators/comparison-operations.html"><strong aria-hidden="true">5.6.3.2.</strong> Comparison Operators</a></li><li class="chapter-item expanded "><a href="../rust/essentials/operators/logical-operations.html"><strong aria-hidden="true">5.6.3.3.</strong> Logical Operators</a></li><li class="chapter-item expanded "><a href="../rust/essentials/operators/bitwise-operations.html"><strong aria-hidden="true">5.6.3.4.</strong> Bitwise Operators</a></li><li class="chapter-item expanded "><a href="../rust/essentials/operators/assignement-operations.html"><strong aria-hidden="true">5.6.3.5.</strong> Assignment Operators</a></li></ol></li><li class="chapter-item expanded "><a href="../rust/essentials/packaging/intro.html"><strong aria-hidden="true">5.6.4.</strong> Packaging</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../rust/essentials/packaging/no-std.html"><strong aria-hidden="true">5.6.4.1.</strong> ![no_std] Attribute</a></li><li class="chapter-item expanded "><a href="../rust/essentials/packaging/modules.html"><strong aria-hidden="true">5.6.4.2.</strong> Requiring Modules</a></li><li class="chapter-item expanded "><a href="../rust/essentials/packaging/package-names.html"><strong aria-hidden="true">5.6.4.3.</strong> Package Names</a></li><li class="chapter-item expanded "><a href="../rust/essentials/packaging/crates-tag.html"><strong aria-hidden="true">5.6.4.4.</strong> Tag your Crate</a></li><li class="chapter-item expanded "><a href="../rust/essentials/packaging/feature-attribute.html"><strong aria-hidden="true">5.6.4.5.</strong> Feature Attribute</a></li><li class="chapter-item expanded "><a href="../rust/essentials/packaging/features-compilation.html"><strong aria-hidden="true">5.6.4.6.</strong> Features Compilation</a></li></ol></li><li class="chapter-item expanded "><a href="../rust/essentials/std-lib/intro.html"><strong aria-hidden="true">5.6.5.</strong> Standard Library</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../rust/essentials/std-lib/refcell.html"><strong aria-hidden="true">5.6.5.1.</strong> RefCell Struct</a></li><li class="chapter-item expanded "><a href="../rust/essentials/std-lib/rc.html"><strong aria-hidden="true">5.6.5.2.</strong> Rc Type</a></li><li class="chapter-item expanded "><a href="../rust/essentials/std-lib/self-as-type.html"><strong aria-hidden="true">5.6.5.3.</strong> Self Type</a></li><li class="chapter-item expanded "><a href="../rust/essentials/std-lib/self-vs-self.html"><strong aria-hidden="true">5.6.5.4.</strong> Self vs self</a></li><li class="chapter-item expanded "><a href="../rust/essentials/std-lib/self.html"><strong aria-hidden="true">5.6.5.5.</strong> self Keyword</a></li><li class="chapter-item expanded "><a href="../rust/essentials/std-lib/imp.html"><strong aria-hidden="true">5.6.5.6.</strong> imp Keyword</a></li><li class="chapter-item expanded "><a href="../rust/essentials/std-lib/new.html"><strong aria-hidden="true">5.6.5.7.</strong> new Keyword</a></li><li class="chapter-item expanded "><a href="../rust/essentials/std-lib/some.html"><strong aria-hidden="true">5.6.5.8.</strong> Some Keyword</a></li><li class="chapter-item expanded "><a href="../rust/essentials/std-lib/option.html"><strong aria-hidden="true">5.6.5.9.</strong> Option Enum</a></li><li class="chapter-item expanded "><a href="../rust/essentials/std-lib/drive(debug).html"><strong aria-hidden="true">5.6.5.10.</strong> #[derive(Debug)]</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../rust/patterns/intro.html"><strong aria-hidden="true">5.7.</strong> Patterns</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../rust/patterns/creational/intro.html"><strong aria-hidden="true">5.7.1.</strong> Creational</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../rust/patterns/creational/singleton.html"><strong aria-hidden="true">5.7.1.1.</strong> Singleton</a></li><li class="chapter-item expanded "><a href="../rust/patterns/creational/factory-method.html"><strong aria-hidden="true">5.7.1.2.</strong> Factory Method</a></li><li class="chapter-item expanded "><a href="../rust/patterns/creational/abstract-method.html"><strong aria-hidden="true">5.7.1.3.</strong> Abstract Factory</a></li><li class="chapter-item expanded "><a href="../rust/patterns/creational/builder.html"><strong aria-hidden="true">5.7.1.4.</strong> Builder</a></li><li class="chapter-item expanded "><a href="../rust/patterns/creational/prototype.html"><strong aria-hidden="true">5.7.1.5.</strong> Prototype</a></li></ol></li><li class="chapter-item expanded "><a href="../rust/patterns/behavioral/intro.html"><strong aria-hidden="true">5.7.2.</strong> Behavioral</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../rust/patterns/behavioral/observer.html"><strong aria-hidden="true">5.7.2.1.</strong> Observer</a></li><li class="chapter-item expanded "><a href="../rust/patterns/behavioral/strategy.html"><strong aria-hidden="true">5.7.2.2.</strong> Strategy</a></li><li class="chapter-item expanded "><a href="../rust/patterns/behavioral/command.html"><strong aria-hidden="true">5.7.2.3.</strong> Command</a></li><li class="chapter-item expanded "><a href="../rust/patterns/behavioral/chain-of-responsibility.html"><strong aria-hidden="true">5.7.2.4.</strong> Chain of Responsibility</a></li><li class="chapter-item expanded "><a href="../rust/patterns/behavioral/iterator.html"><strong aria-hidden="true">5.7.2.5.</strong> Iterator</a></li><li class="chapter-item expanded "><a href="../rust/patterns/behavioral/mediator.html"><strong aria-hidden="true">5.7.2.6.</strong> Mediator</a></li><li class="chapter-item expanded "><a href="../rust/patterns/behavioral/visitor.html"><strong aria-hidden="true">5.7.2.7.</strong> Visitor</a></li></ol></li><li class="chapter-item expanded "><a href="../rust/patterns/structural/intro.html"><strong aria-hidden="true">5.7.3.</strong> Structural</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../rust/patterns/structural/adapter.html"><strong aria-hidden="true">5.7.3.1.</strong> Adapter</a></li><li class="chapter-item expanded "><a href="../rust/patterns/structural/bridge.html"><strong aria-hidden="true">5.7.3.2.</strong> Bridge</a></li><li class="chapter-item expanded "><a href="../rust/patterns/structural/composite.html"><strong aria-hidden="true">5.7.3.3.</strong> Composite</a></li><li class="chapter-item expanded "><a href="../rust/patterns/structural/decorator.html"><strong aria-hidden="true">5.7.3.4.</strong> Decorator</a></li><li class="chapter-item expanded "><a href="../rust/patterns/structural/facade.html"><strong aria-hidden="true">5.7.3.5.</strong> Facade</a></li><li class="chapter-item expanded "><a href="../rust/patterns/structural/flyweight.html"><strong aria-hidden="true">5.7.3.6.</strong> Flyweight</a></li><li class="chapter-item expanded "><a href="../rust/patterns/structural/proxy.html"><strong aria-hidden="true">5.7.3.7.</strong> Proxy</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../rust/algorithms/intro.html"><strong aria-hidden="true">5.8.</strong> Algorithms</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../rust/algorithms/sorting/intro.html"><strong aria-hidden="true">5.8.1.</strong> Sorting</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../rust/algorithms/sorting/buble.html"><strong aria-hidden="true">5.8.1.1.</strong> Buble Sort</a></li><li class="chapter-item expanded "><a href="../rust/algorithms/sorting/quick.html"><strong aria-hidden="true">5.8.1.2.</strong> Quick Sort</a></li><li class="chapter-item expanded "><a href="../rust/algorithms/sorting/merge.html"><strong aria-hidden="true">5.8.1.3.</strong> Merge Sort</a></li><li class="chapter-item expanded "><a href="../rust/algorithms/sorting/heap.html"><strong aria-hidden="true">5.8.1.4.</strong> Heap Sort</a></li><li class="chapter-item expanded "><a href="../rust/algorithms/sorting/counting.html"><strong aria-hidden="true">5.8.1.5.</strong> Counting Sort</a></li></ol></li><li class="chapter-item expanded "><a href="../rust/algorithms/searching/intro.html"><strong aria-hidden="true">5.8.2.</strong> Searching</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../rust/algorithms/searching/linear.html"><strong aria-hidden="true">5.8.2.1.</strong> Linear Search</a></li><li class="chapter-item expanded "><a href="../rust/algorithms/searching/binary.html"><strong aria-hidden="true">5.8.2.2.</strong> Binary Search</a></li><li class="chapter-item expanded "><a href="../rust/algorithms/searching/depth-first.html"><strong aria-hidden="true">5.8.2.3.</strong> DFS</a></li><li class="chapter-item expanded "><a href="../rust/algorithms/searching/breadth-first.html"><strong aria-hidden="true">5.8.2.4.</strong> BFS</a></li></ol></li><li class="chapter-item expanded "><a href="../rust/algorithms/graph/intro.html"><strong aria-hidden="true">5.8.3.</strong> Graph</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../rust/algorithms/graph/shortest-path.html"><strong aria-hidden="true">5.8.3.1.</strong> Dijkstra’s Algorithm</a></li><li class="chapter-item expanded "><a href="../rust/algorithms/graph/minimum-spanning-tree.html"><strong aria-hidden="true">5.8.3.2.</strong> Kruskal’s Algorithm </a></li><li class="chapter-item expanded "><a href="../rust/algorithms/graph/a-star.html"><strong aria-hidden="true">5.8.3.3.</strong> A* Algorithm </a></li><li class="chapter-item expanded "><a href="../rust/algorithms/graph/all-pairs-shortest-path.html"><strong aria-hidden="true">5.8.3.4.</strong> Floyd-Warshall Algorithm</a></li></ol></li><li class="chapter-item expanded "><a href="../rust/algorithms/dynamic-programming/intro.html"><strong aria-hidden="true">5.8.4.</strong> Dynamic Programming</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../rust/algorithms/dynamic-programming/knapsack-problem.html"><strong aria-hidden="true">5.8.4.1.</strong> Knapsack Problem</a></li><li class="chapter-item expanded "><a href="../rust/algorithms/dynamic-programming/longest-common-subsequence.html"><strong aria-hidden="true">5.8.4.2.</strong> Longest Common Subsequence</a></li><li class="chapter-item expanded "><a href="../rust/algorithms/dynamic-programming/matrix-chain-multiplication.html"><strong aria-hidden="true">5.8.4.3.</strong> Matrix Chain Multiplication</a></li><li class="chapter-item expanded "><a href="../rust/algorithms/dynamic-programming/fibonacci.html"><strong aria-hidden="true">5.8.4.4.</strong> Fibonacci Sequence</a></li></ol></li><li class="chapter-item expanded "><a href="../rust/algorithms/cryptographic/intro.html"><strong aria-hidden="true">5.8.5.</strong> Cryptography</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../rust/algorithms/cryptographic/rsa.html"><strong aria-hidden="true">5.8.5.1.</strong> RSA</a></li><li class="chapter-item expanded "><a href="../rust/algorithms/cryptographic/aes.html"><strong aria-hidden="true">5.8.5.2.</strong> AES</a></li><li class="chapter-item expanded "><a href="../rust/algorithms/cryptographic/sha-256.html"><strong aria-hidden="true">5.8.5.3.</strong> SHA-256</a></li><li class="chapter-item expanded "><a href="../rust/algorithms/cryptographic/diffie-hellman.html"><strong aria-hidden="true">5.8.5.4.</strong> Diffie-Hellman</a></li><li class="chapter-item expanded "><a href="../rust/algorithms/cryptographic/bcrypt.html"><strong aria-hidden="true">5.8.5.5.</strong> Bcrypt</a></li></ol></li></ol></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.</strong> React</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../react/bai-1.html"><strong aria-hidden="true">6.1.</strong> Bài 1</a></li><li class="chapter-item expanded "><a href="../react/bai-2.html"><strong aria-hidden="true">6.2.</strong> Bài 2</a></li><li class="chapter-item expanded "><a href="../react/bai-3.html"><strong aria-hidden="true">6.3.</strong> Bài 3</a></li></ol></li><li class="chapter-item expanded "><a href="../react-native/index.html"><strong aria-hidden="true">7.</strong> React Native</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">8.</strong> TypeScript</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../ts/bai-1.html"><strong aria-hidden="true">8.1.</strong> Bài 1</a></li></ol></li><li class="chapter-item expanded "><a href="../bash/tong-hop.html"><strong aria-hidden="true">9.</strong> Bash</a></li><li class="chapter-item expanded "><a href="../regex/tong-hop.html"><strong aria-hidden="true">10.</strong> Regex</a></li><li class="chapter-item expanded "><a href="../khac/yt-dlp.html"><strong aria-hidden="true">11.</strong> yt-dlp</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Kho code của duykhanh471</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="ss-hướng-dẫn-spring-security--jwt-json-web-token--hibernate"><a class="header" href="#ss-hướng-dẫn-spring-security--jwt-json-web-token--hibernate">[SS] Hướng dẫn Spring Security + JWT (Json Web Token) + Hibernate</a></h1>
<ul>
<li>Giới thiệu</li>
<li>Cài đặt</li>
<li>Implement</li>
<li>Tạo User</li>
<li>Tham chiếu User với UserDetails</li>
<li>JWT</li>
<li>Cấu hình và phân quyền</li>
<li>Tạo Controller</li>
<li>Tạo thông tin User trong database</li>
<li>Chạy thử</li>
<li>Kết</li>
</ul>
<h3 id="giới-thiệu"><a class="header" href="#giới-thiệu"><strong>Giới thiệu</strong></a></h3>
<p>Xin chào các bạn, Trong hai bài trước tôi đã giới thiệu cách sử dụng <strong>Spring Security</strong> và kết nối với database để xác thực người dùng.</p>
<ol>
<li>Spring Security Cơ bản</li>
<li>Spring Security + Hibernate</li>
</ol>
<p>Trong bài hôm nay chúng ta sẽ tìm hiểu một phần cực kỳ quan trọng trong các hệ thống bảo mật ngày nay, đó là <strong>JWT</strong>.</p>
<p><strong>JWT (Json web Token)</strong> là một chuỗi mã hóa được gửi kèm trong Header của client request có tác dụng giúp phía server xác thực request người dùng có hợp lệ hay không. Được sử dụng phổ biến trong các hệ thống API ngày nay.</p>
<p>!image</p>
<h3 id="cài-đặt"><a class="header" href="#cài-đặt"><strong>Cài đặt</strong></a></h3>
<p>Chúng ta sử dụng Maven giống bài trước, tuy nhiên có update thêm thư viện <code>io.jsonwebtoken.jwtt</code> để giúp chúng ta mã hóa thông tin thành <code>jwt</code></p>
<p><em>pom.xml</em></p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;groupId&gt;org.springframework&lt;/groupId&gt;
    &lt;artifactId&gt;spring-security-jwt&lt;/artifactId&gt;
    &lt;version&gt;0.1.0&lt;/version&gt;

    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;2.0.5.RELEASE&lt;/version&gt;
    &lt;/parent&gt;

    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.h2database&lt;/groupId&gt;
            &lt;artifactId&gt;h2&lt;/artifactId&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt;
            &lt;artifactId&gt;jjwt&lt;/artifactId&gt;
            &lt;version&gt;0.9.1&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

    &lt;properties&gt;
        &lt;java.version&gt;1.8&lt;/java.version&gt;
    &lt;/properties&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;

&lt;/project&gt;
</code></pre>
<p>Cấu trúc thư mục code bao gồm:</p>
<p>!image</p>
<h3 id="implement"><a class="header" href="#implement"><strong>Implement</strong></a></h3>
<p>Ban đầu, chúng ta sẽ tạo ra class <code>User</code> và <code>UserDetails</code> để giao tiếp với <strong>Spring Security</strong>. Phần này giống hệt với bài viết Spring Security + Hibernate</p>
<p>Trong bài viết có sử dụng Lombok</p>
<h3 id="tạo-user"><a class="header" href="#tạo-user"><strong>Tạo User</strong></a></h3>
<p>Tạo ra class <code>User</code> tham chiếu với database.</p>
<pre><code>import javax.persistence.Column;
import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.Id;
import javax.persistence.Table;

import lombok.Data;

@Entity
@Table(name = &quot;user&quot;)
@Data // lombok
public class User {
    @Id
    @GeneratedValue
    private Long id;

    @Column(nullable = false, unique = true)
    private String username;
    private String password;
}
</code></pre>
<p>Tạo <code>UserRepository</code> kế thừa <code>JpaRepository</code> để truy xuất thông tin từ database.</p>
<pre><code>import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;

@Repository
public interface UserRepository extends JpaRepository&lt;User, Long&gt; {
    User findByUsername(String username);
}
</code></pre>
<h3 id="tham-chiếu-user-với-userdetails"><a class="header" href="#tham-chiếu-user-với-userdetails"><strong>Tham chiếu User với UserDetails</strong></a></h3>
<p>Mặc định <strong>Spring Security</strong> sử dụng một đối tượng <code>UserDetails</code> để chứa toàn bộ thông tin về người dùng. Vì vậy, chúng ta cần tạo ra một class mới giúp chuyển các thông tin của <code>User</code> thành <code>UserDetails</code></p>
<p><em>CustomUserDetails.java</em></p>
<pre><code>import org.springframework.security.core.GrantedAuthority;
import org.springframework.security.core.authority.SimpleGrantedAuthority;
import org.springframework.security.core.userdetails.UserDetails;

import lombok.AllArgsConstructor;
import lombok.Data;

@Data
@AllArgsConstructor
public class CustomUserDetails implements UserDetails {
    User user;

    @Override
    public Collection&lt;? extends GrantedAuthority&gt; getAuthorities() {
        // Mặc định mình sẽ để tất cả là ROLE_USER. Để demo cho đơn giản.
        return Collections.singleton(new SimpleGrantedAuthority(&quot;ROLE_USER&quot;));
    }

    @Override
    public String getPassword() {
        return user.getPassword();
    }

    @Override
    public String getUsername() {
        return user.getUsername();
    }

    @Override
    public boolean isAccountNonExpired() {
        return true;
    }

    @Override
    public boolean isAccountNonLocked() {
        return true;
    }

    @Override
    public boolean isCredentialsNonExpired() {
        return true;
    }

    @Override
    public boolean isEnabled() {
        return true;
    }
}
</code></pre>
<p>Khi người dùng đăng nhập thì <strong>Spring Security</strong> sẽ cần lấy các thông tin <code>UserDetails</code> hiện có để kiểm tra. Vì vậy, bạn cần tạo ra một class kế thừa lớp <code>UserDetailsService</code> mà <strong>Spring Security</strong> cung cấp để làm nhiệm vụ này.</p>
<p><em>UserService.java</em></p>
<pre><code>import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.core.userdetails.UsernameNotFoundException;
import org.springframework.stereotype.Service;

@Service
public class UserService implements UserDetailsService {

    @Autowired
    private UserRepository userRepository;

    @Override
    public UserDetails loadUserByUsername(String username) {
        // Kiểm tra xem user có tồn tại trong database không?
        User user = userRepository.findByUsername(username);
        if (user == null) {
            throw new UsernameNotFoundException(username);
        }
        return new CustomUserDetails(user);
    }

}
</code></pre>
<h3 id="jwt"><a class="header" href="#jwt"><strong>JWT</strong></a></h3>
<p>Sau khi có các thông tin về người dùng, chúng ta cần mã hóa thông tin người dùng thành chuỗi <code>JWT</code>. Tôi sẽ tạo ra một class <code>JwtTokenProvider</code> để làm nhiệm vụ này.</p>
<pre><code>import org.springframework.stereotype.Component;
import io.jsonwebtoken.*;
import lombok.extern.slf4j.Slf4j;
import me.loda.springsecurityhibernatejwt.user.CustomUserDetails;

@Component
@Slf4j
public class JwtTokenProvider {
    // Đoạn JWT_SECRET này là bí mật, chỉ có phía server biết
    private final String JWT_SECRET = &quot;lodaaaaaa&quot;;

    //Thời gian có hiệu lực của chuỗi jwt
    private final long JWT_EXPIRATION = 604800000L;

    // Tạo ra jwt từ thông tin user
    public String generateToken(CustomUserDetails userDetails) {
        Date now = new Date();
        Date expiryDate = new Date(now.getTime() + JWT_EXPIRATION);
        // Tạo chuỗi json web token từ id của user.
        return Jwts.builder()
                   .setSubject(Long.toString(userDetails.getUser().getId()))
                   .setIssuedAt(now)
                   .setExpiration(expiryDate)
                   .signWith(SignatureAlgorithm.HS512, JWT_SECRET)
                   .compact();
    }

    // Lấy thông tin user từ jwt
    public Long getUserIdFromJWT(String token) {
        Claims claims = Jwts.parser()
                            .setSigningKey(JWT_SECRET)
                            .parseClaimsJws(token)
                            .getBody();

        return Long.parseLong(claims.getSubject());
    }

    public boolean validateToken(String authToken) {
        try {
            Jwts.parser().setSigningKey(JWT_SECRET).parseClaimsJws(authToken);
            return true;
        } catch (MalformedJwtException ex) {
            log.error(&quot;Invalid JWT token&quot;);
        } catch (ExpiredJwtException ex) {
            log.error(&quot;Expired JWT token&quot;);
        } catch (UnsupportedJwtException ex) {
            log.error(&quot;Unsupported JWT token&quot;);
        } catch (IllegalArgumentException ex) {
            log.error(&quot;JWT claims string is empty.&quot;);
        }
        return false;
    }
}
</code></pre>
<h3 id="cấu-hình-và-phân-quyền"><a class="header" href="#cấu-hình-và-phân-quyền"><strong>Cấu hình và phân quyền</strong></a></h3>
<p>Bây giờ, chúng ta bắt đầu cấu hình <strong>Spring Security</strong> bao gồm việc kích hoạt bằng <code>@EnableWebSecurity</code>.</p>
<p>Bước này giống với bài viết Spring + Hibernate nên tôi sẽ không nói những phần lặp lại.</p>
<pre><code>import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Bean;
import org.springframework.security.authentication.AuthenticationManager;
import org.springframework.security.config.BeanIds;
import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;
import me.loda.springsecurityhibernatejwt.jwt.JwtAuthenticationFilter;
import me.loda.springsecurityhibernatejwt.user.UserService;

@EnableWebSecurity
public class WebSecurityConfig extends WebSecurityConfigurerAdapter {

    @Autowired
    UserService userService;

    @Bean
    public JwtAuthenticationFilter jwtAuthenticationFilter() {
        return new JwtAuthenticationFilter();
    }

    @Bean(BeanIds.AUTHENTICATION_MANAGER)
    @Override
    public AuthenticationManager authenticationManagerBean() throws Exception {
        // Get AuthenticationManager bean
        return super.authenticationManagerBean();
    }

    @Bean
    public PasswordEncoder passwordEncoder() {
        // Password encoder, để Spring Security sử dụng mã hóa mật khẩu người dùng
        return new BCryptPasswordEncoder();
    }

    @Override
    protected void configure(AuthenticationManagerBuilder auth)
            throws Exception {
        auth.userDetailsService(userService) // Cung cáp userservice cho spring security
            .passwordEncoder(passwordEncoder()); // cung cấp password encoder
    }

    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http
                .cors() // Ngăn chặn request từ một domain khác
                    .and()
                .authorizeRequests()
                    .antMatchers(&quot;/api/login&quot;).permitAll() // Cho phép tất cả mọi người truy cập vào địa chỉ này
                    .anyRequest().authenticated(); // Tất cả các request khác đều cần phải xác thực mới được truy cập

        // Thêm một lớp Filter kiểm tra jwt
        http.addFilterBefore(jwtAuthenticationFilter(), UsernamePasswordAuthenticationFilter.class);
    }
}
</code></pre>
<p>Điểm khác biệt ở đây là sự xuất hiện của <code>JwtAuthenticationFilter</code>. Đây là một lớp <code>Filter</code> do tôi tự tạo ra.</p>
<p><code>JwtAuthenticationFilter</code> Có nhiệm vụ kiểm tra request của người dùng trước khi nó tới đích. Nó sẽ lấy <code>Header Authorization</code> ra và kiểm tra xem chuỗi JWT người dùng gửi lên có hợp lệ không.</p>
<pre><code>@Slf4j
public class JwtAuthenticationFilter extends OncePerRequestFilter {
    @Autowired
    private JwtTokenProvider tokenProvider;

    @Autowired
    private UserService customUserDetailsService;
    @Override
    protected void doFilterInternal(HttpServletRequest request,
                                    HttpServletResponse response, FilterChain filterChain)
            throws ServletException, IOException {
        try {
            // Lấy jwt từ request
            String jwt = getJwtFromRequest(request);

            if (StringUtils.hasText(jwt) &amp;&amp; tokenProvider.validateToken(jwt)) {
                // Lấy id user từ chuỗi jwt
                Long userId = tokenProvider.getUserIdFromJWT(jwt);
                // Lấy thông tin người dùng từ id
                UserDetails userDetails = customUserDetailsService.loadUserById(userId);
                if(userDetails != null) {
                    // Nếu người dùng hợp lệ, set thông tin cho Seturity Context
                    UsernamePasswordAuthenticationToken
                            authentication = new UsernamePasswordAuthenticationToken(userDetails, null, userDetails.getAuthorities());
                    authentication.setDetails(new WebAuthenticationDetailsSource().buildDetails(request));

                    SecurityContextHolder.getContext().setAuthentication(authentication);
                }
            }
        } catch (Exception ex) {
            log.error(&quot;failed on set user authentication&quot;, ex);
        }

        filterChain.doFilter(request, response);
    }

    private String getJwtFromRequest(HttpServletRequest request) {
        String bearerToken = request.getHeader(&quot;Authorization&quot;);
        // Kiểm tra xem header Authorization có chứa thông tin jwt không
        if (StringUtils.hasText(bearerToken) &amp;&amp; bearerToken.startsWith(&quot;Bearer &quot;)) {
            return bearerToken.substring(7);
        }
        return null;
    }
}
</code></pre>
<h3 id="tạo-controller"><a class="header" href="#tạo-controller"><strong>Tạo Controller</strong></a></h3>
<p>Vì phần này chúng ta làm việc với <code>JWT</code>, nên các request sẽ dưới dạng Rest API.</p>
<p>Tôi tạo ra 2 api:</p>
<ol>
<li><code>/api/login</code>: Cho phép request mà không cần xác thực.</li>
<li><code>/api/random</code>: Là một api bất kỳ nào đó, phải xác thực mới lấy được thông tin.</li>
</ol>
<pre><code>@RestController
@RequestMapping(&quot;/api&quot;)
public class LodaRestController {

    @Autowired
    AuthenticationManager authenticationManager;

    @Autowired
    private JwtTokenProvider tokenProvider;

    @PostMapping(&quot;/login&quot;)
    public LoginResponse authenticateUser(@Valid @RequestBody LoginRequest loginRequest) {

        // Xác thực từ username và password.
        Authentication authentication = authenticationManager.authenticate(
                new UsernamePasswordAuthenticationToken(
                        loginRequest.getUsername(),
                        loginRequest.getPassword()
                )
        );

        // Nếu không xảy ra exception tức là thông tin hợp lệ
        // Set thông tin authentication vào Security Context
        SecurityContextHolder.getContext().setAuthentication(authentication);

        // Trả về jwt cho người dùng.
        String jwt = tokenProvider.generateToken((CustomUserDetails) authentication.getPrincipal());
        return new LoginResponse(jwt);
    }

    // Api /api/random yêu cầu phải xác thực mới có thể request
    @GetMapping(&quot;/random&quot;)
    public RandomStuff randomStuff(){
        return new RandomStuff(&quot;JWT Hợp lệ mới có thể thấy được message này&quot;);
    }

}
</code></pre>
<h3 id="tạo-thông-tin-user-trong-database"><a class="header" href="#tạo-thông-tin-user-trong-database"><strong>Tạo thông tin User trong database</strong></a></h3>
<p>Trước hết bạn cần cấu hình cho hibernate kết tới tới h2 database trong file <code>resources/appication.properties</code></p>
<pre><code>spring.datasource.url=jdbc:h2:mem:testdb
spring.datasource.driverClassName=org.h2.Driver
spring.datasource.username=sa
spring.datasource.password=

spring.jpa.database-platform=org.hibernate.dialect.H2Dialect
# Enabling H2 Console
spring.h2.console.enabled=true
</code></pre>
<p>Để phục vụ demo, mỗi khi chạy chương trình, chúng ta cần insert một <code>User</code> vào database.</p>
<p>Có thể làm việc này bằng cách sử dụng <code>CommandLineRunner</code>. Một interface của Spring cung cấp, có tác dụng thực hiện một nhiệm vụ khi Spring khởi chạy lần đầu.</p>
<pre><code>@SpringBootApplication
public class App implements CommandLineRunner {
    public static void main(String[] args) {
        SpringApplication.run(App.class, args);
    }

    @Autowired
    UserRepository userRepository;
    @Autowired
    PasswordEncoder passwordEncoder;

    @Override
    public void run(String... args) throws Exception {
        // Khi chương trình chạy
        // Insert vào csdl một user.
        User user = new User();
        user.setUsername(&quot;loda&quot;);
        user.setPassword(passwordEncoder.encode(&quot;loda&quot;));
        userRepository.save(user);
        System.out.println(user);
    }
}
</code></pre>
<h3 id="chạy-thử"><a class="header" href="#chạy-thử"><strong>Chạy thử</strong></a></h3>
<p>Khi server on, chúng ta request thử tới địa chỉ <code>http://localhost:8080/api/random</code> mà không xác thực.</p>
<p>!image</p>
<p>Kết quả trả về mã lỗi <code>403</code> kèm theo message <code>Access Denied</code>.</p>
<p>Để có thể request được, chúng ta đăng nhập vào hệ thống bằng <code>api/login</code> để lấy <code>jwt</code>.</p>
<p>!image</p>
<p>Sau đó sử dụng thông tin <code>jwt</code> server trả về để thực hiện các request khác.</p>
<p>!image</p>
<h3 id="kết"><a class="header" href="#kết"><strong>Kết</strong></a></h3>
<p>Trong bài này, chúng ta đã tìm hiểu cách sử dụng <strong>Spring Security</strong> và <strong>JWT</strong> để có thể xác thực người dùng trong các hệ thống Restful API. Chúng ta sẽ tìm hiểu các cách xác thực <code>OAuth 2.0</code> ở các bài sau.</p>
<p>💁 Nếu có, toàn bộ project / code mẫu được lưu trữ tại <strong>GitHub</strong></p>
<p>🌟 Đây là một bài viết trong Series <strong>Làm chủ Spring Boot – Zero to Hero</strong></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../spring-boot/ss2.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../spring-boot/redis.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../spring-boot/ss2.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../spring-boot/redis.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
